{{ config(database="MHA_DATA") }}

WITH CTE AS (
SELECT "ACTUALMANHOURS":: DEC(10,2) AS "ACTUALMANHOURS"
      ,"ASAPDATE"::DATE AS "ASAPDATE"
      ,"BILLTYPE"
      ,"COMPANYID"
      ,"CREWSIZE"::DEC(10,0) AS "CREWSIZE"
      ,"CUSTOMERNUMBER"
      ,"DISCOUNTAMOUNT":: DEC(10,2) AS "DISCAMT"
      ,"DISCOUNTCODE"
      ,"DONEDATE"::DATE AS "DONEDATE"
      ,"DURATION"
      ,"END"
      ,"ESTIMATEDMANHOURS"::DEC(10,2) AS "ESTIMATEDMANHOURS"
      ,"ID"
      ,"INVOICENUMBER"
      ,"ISDEPENDENTSERVICE"
      ,"ISPAID"
      ,"NEXTPRICE"::DEC(10,2) AS "NEXTPRICE"
      ,"NEXTSIZE"::DEC(10,2) AS "NEXTSIZE"
      ,"POSTBY"
      ,"POSTEDDATE"::DATE AS "POSTEDDATE"
      ,"PREPAYAMOUNT"::DEC(10,2) AS "PREPAMT"
      ,"PRICE"::DEC(10,2) AS "SALESAMT"
      ,"PRODUCTIONVALUE"::DEC(10,2) AS "PRODVALUE"
      ,"PROGRAMDISCOUNTAMOUNT"::DEC(10,2) AS "PROGRAMDISCOUNTAMOUNT"
      ,"PROGRAMID"
      ,"ROUND"
      ,"SERVICECODE"
      ,"SERVICESTATUS"
      ,"SERVICEYEAR"
      ,"SIZE"::DEC(10,2) AS "SIZE"
      ,"START"
      ,"STARTDATE"::DATE AS "STARTDATE"
      ,"TAXABLEAMOUNT1"::DEC(10,2) AS "TAXABLEAMOUNT"
      ,"TAXAMOUNT1"::DEC(10,2) AS "TAXAMOUNT"
      ,"TOTALAMOUNT"::DEC(10,2) AS "TOTALAMOUNT"
FROM "FIVETRAN_DATABASE"."STAGE_DBO"."SERVICE")
SELECT "ACTUALMANHOURS"
      ,"ASAPDATE"
      ,"BILLTYPE"
      ,"COMPANYID"
      ,"CREWSIZE"
      ,"CUSTOMERNUMBER"
      ,IFNULL("DISCAMT", 0) AS "DISCAMT"
      ,"DISCOUNTCODE"
      ,"DONEDATE"
      ,"DURATION"
      ,"END"
      ,"ESTIMATEDMANHOURS"
      ,"ID"
      ,"INVOICENUMBER"
      ,"ISDEPENDENTSERVICE"
      ,"ISPAID"
      ,"NEXTPRICE"
      ,"NEXTSIZE"
      ,"POSTBY"
      ,"POSTEDDATE"
      ,IFNULL("PREPAMT", 0) AS "PREPAMT"
      ,IFNULL("SALESAMT", 0) AS "SALESAMT"
      ,IFNULL("PRODVALUE", 0) AS "PRODVALUE"
      ,IFNULL("PROGRAMDISCOUNTAMOUNT", 0) AS "PROGRAMDISCOUNTAMOUNT"
      ,"PROGRAMID"
      ,"ROUND"
      ,"SERVICECODE"
      ,"SERVICESTATUS"
      ,"SERVICEYEAR"
      ,"SIZE"
      ,"START"
      ,"STARTDATE"
      ,"TAXABLEAMOUNT"
      ,"TAXAMOUNT"
      ,"TOTALAMOUNT"
      ,IFNULL("SALESAMT", 0) - IFNULL("DISCAMT", 0) - IFNULL("PREPAMT", 0) AS "ACTUALAMT"
FROM CTE  